<!DOCTYPE html><html><head><link rel="stylesheet" href="tufte.css"/><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>xmark = Markdown + Tufte CSS</title><style type="text/css">
                                        .toc-3 { margin-left: 2rem; }
                                        .toc-4 { margin-left: 4rem; }
                                </style></head><body><article><h1>xmark = Markdown + Tufte CSS</h1><p class="subtitle">Antonio Vieiro</p><h2 id="idm35151467281712">A brief introduction</h2><p><a href="https://daringfireball.net/projects/markdown/" title="">Markdown</a> is a plain text format for writing structured documents, based on formatting conventions from email and usenet.  It was developed in 2004 by John Gruber.</p><p><a href="http://commonmark.org" title="">CommonMark</a> is a proposal for a standard, <strong>unambiguous syntax specification for Markdown</strong>, along with a <strong>suite of comprehensive tests</strong> to validate Markdown implementations against this specification. It was created by a group of <a href="http://commonmark.org" title="">Markdown fans</a>.</p><p><a href="https://edwardtufte.github.io/tufte-css/" title="">tufte-css</a> provides tools to style web articles using the ideas demonstrated by Edward Tufte's books and handouts. It was created by <a href="http://www.daveliepmann.com/" title="">Dave Liepmann</a> in late 2015 and is now an Edward Tufte project.</p><p><a href="https://github.com/vieiro/xmark" title="">xmark</a> is a simple XSLT stylesheet that transforms CommonMark compliant plain text documents (<a href="https://raw.githubusercontent.com/vieiro/xmark/master/test.markdown" title="">see the source of this one here</a>), with some additional conventions, into tufte-css styled web pages.</p><p>This document enumerates the goals of xmark, its conventions and explains how to use it.</p><h2 id="idm35151467319472">xmark goals</h2><p>xmark has two main goals:</p><h3 id="idm35151467322416">I: Generate tufte-css styled web pages</h3><p>The first goal of xmark is to generate tufte-css styled web pages from plain text files that follow the CommonMark specification.</p><h3 id="idm35151467325872">II: Serve as an experimentation tool</h3><p>The second goal of xmark is to serve as a tool to manipulate the XML structure generated with CommonMark's cmark parser. By modifying a simple XSLT one can generate all sort of structured documents out from plain CommonMark text files.</p><h2 id="idm35151467198512">xmark conventions</h2><p>Nor Markdown nor CommonMark support document metadata so, for instance, there is no standard way to specify a title in a CommonMark document. It is not possible either to mark a paragraph as an epigraph, or as a figure caption, or as a margin note.</p><p><label for="idm35151467202864" class="margin-toggle sidenote-number"/><input id="idm35151467202864" type="checkbox" class="margin-toggle"><span class="sidenote"><em>Def. xmark convention</em>: a simple rule that allows emulating metadata in CommonMark markdown documents.</span></input> These limitations in Markdown, and in the CommonMark standard, are overcome in xmark by means of conventions, that assign special meanings to paragraphs. This section lists these conventions:</p><h3 id="idm35151467207600">Document title convention</h3><blockquote><p>The document title is the first section of the document with level one. This is, the first paragraph tagged with a single '#' in the markdown document.</p></blockquote><p>It does not matter where you hide the first level one tag in your markdown document: xmark always places the title as the first paragraph of the document, using an <span class="code">&lt;h1&gt;</span> HTML tag. The title does not appear in the Table of Contents.</p><pre class="code"><code class="code"># This is the document title
</code></pre><p>Of course, the document title is also set in the <span class="code">&lt;title&gt;</span> HTML tag of the resulting document.</p><h3 id="idm35151467240240">Document sutbitle convention</h3><blockquote><p>The document subtitle is the first section of the document with level two. This is, the first paragraph tagged with a double '##' in the document.</p></blockquote><p>For instance:</p><pre class="code"><code class="code">## This is the document subtitle
</code></pre><p>It does not matter where you specify the subtitle in the source document, xmark always places the subtitle as the second paragraph of the document, using the <span class="code">&lt;p class='subtitle'&gt;</span> tufte-css element. The subtitle does not appear in the Table of Contents.</p><h3 id="idm35151467234480">Epigraph convention</h3><p>CommonMark does not support epigraphs, but allows for nested block quotes. xmark makes use of this feature, making the double-nested block quotes work as epigraphs:</p><blockquote><p>Two-level nested block quotes (i.e., a pagraph starting with <span class="code">&gt;&gt;</span>) are always transformed to epigraphs.</p></blockquote><p>So, for instance, this text:</p><pre class="code"><code class="code">&gt;&gt; xmark epigraphs are started with two ```&gt;``` at the beginning of the paragraph.
</code></pre><p>Will generate a tufte-css epigraph like this one:</p><div class="epigraph"><blockquote><p>xmark epigraphs are started with two <span class="code">&gt;</span> at the beginning of the paragraph.</p></blockquote></div><p>Epigraphs may also contain a footer using plain HTML, but you will have to specify the <span class="code">footer</span> and <span class="code">cite</span> in plain HTML, like this one:</p><pre class="code"><code class="code">&gt;&gt; I do not paint things, I paint only the differences between things.
&gt;&gt; &lt;footer&gt;Henri Matisse, &lt;cite&gt;Henri Matisse Dessins:
&gt;&gt; thèmes et variations&lt;/cite&gt; (Paris, 1943), 37&lt;/footer&gt;&lt;/blockquote&gt;
</code></pre><p>That gets translated in the following HTML:</p><div class="epigraph"><blockquote><p>I do not paint things, I paint only the differences between things.</p><footer>Henri Matisse, <cite>Henri Matisse Dessins: thèmes et variations</cite> (Paris, 1943), 37</footer></blockquote>
</blockquote></div><h3 id="idm35151467251248">Sidenote convention</h3><p>Nor markdown nor CommonMark support sidenotes <label for="idm35151467249456" class="margin-toggle sidenote-number"/><input id="idm35151467249456" type="checkbox" class="margin-toggle"><span class="sidenote">Sidenotes are like footnotes, except they don't force the user to scroll the page</span></input>.</p><p>Markdown uses the <span class="code">[link text](url)</span> structure to define links. xmark abuses this structure with the following convention:</p><blockquote><p>Sidenotes are normal markdown links that use the word <span class="code">sidenote</span> as its url.</p></blockquote><p>Sidenote numbers are automatically generated, so there's no need to worry about that detail.</p><pre class="code"><code class="code">This is a normal paragraph with a
sidenote [Write your sidenotes
inside square brackets and then
add a ```(sidenote)```
url.](sidenote).
</code></pre><p>Will produce the following paragraph with a sidenote:</p><p>This is a normal paragraph with a sidenote <label for="idm35151467142320" class="margin-toggle sidenote-number"/><input id="idm35151467142320" type="checkbox" class="margin-toggle"><span class="sidenote">Write your sidenotes inside square brackets and then add a <span class="code">(sidenote)</span> url.</span></input>.</p><p>As in tufte-css, sidenotes (and margin notes, below) are visible in wider screens, but are hidden in smaller screens. In these smaller screens, the symbol ⊕  (<span class="code">&amp;#8853;</span>) or the sidenote number can be tapped to view the content.</p><h3 id="idm35151467137712">Margin note convention</h3><p>Margin notes are just like sidenotes, but do not have footnote-style numbers. The xmark convention for margin notes is similar to the previous convention:</p><blockquote><p>To create a margin note write a normal markdown link, but use the word <span class="code">margin</span> as the url.</p></blockquote><p>So, for instance, the markdown text:</p><pre class="code"><code class="code">For example, this paragraph has a
[Margin note text here](margin)
margin note.
</code></pre><p>Will result in the following paragraph with a margin note:</p><p>For example, this paragraph has a <label for="idm35151467130288" class="margin-toggle">⊕</label><input id="idm35151467130288" type="checkbox" class="margin-toggle"><span class="marginnote">Margin note text here</span></input> margin note.</p><h3 id="idm35151467161392">Figure convention</h3><p>CommonMark supports images by using the construction:</p><pre class="code"><code class="code">![alt](url "title")]
</code></pre><p>that gets translated by CommonMark into the following HTML:</p><pre class="code"><code class="code">&lt;img src='url' alt='alt' title='title' /&gt;
</code></pre><p>Sadly nor CommonMark nor Markdown support figures with captions <a href="http://talk.commonmark.org/t/image-tag-should-expand-to-figure-when-used-with-title/265/5" title="">(there's an ongoing discussion, though)</a>.</p><p>To overcome this limitation xmark uses the following convention</p><blockquote><p>Use the 'alt' text as the caption for the figure, and abuse the 'title' text as both the HTML alt and the title.</p></blockquote><p>So, for instance, the following text:</p><pre class="code"><code class="code">![From Edward Tufte, *Visual Display of
Quantitative Information*,
page 92.](tufte-css/img/exports-imports.png
"Visual Display of Quantitative Information")
</code></pre><p>Will be transformed in the following <span class="code">&lt;figure&gt;</span>, <span class="code">&lt;img&gt;</span> and <span class="code">&lt;caption&gt;</span>:</p><p><figure><img src="tufte-css/img/exports-imports.png" title="Visual Display of Quantitative Information"/><figcaption>
                                                Fig. 1. From Edward Tufte, <em>Visual Display of Quantitative Information</em>, page 92.</figcaption></figure></p><p>Note that figures are automatically numbered by xmark.</p><h3 id="idm35151467175984">Margin and full-width figure conventions</h3><p>Graphics that are ancillary to the main body of the text are placed in margin figures in tufte-css.</p><p>But CommonMark and Markdown have just a single construct for images.  <label for="idm35151467173296" class="margin-toggle">⊕</label><input id="idm35151467173296" type="checkbox" class="margin-toggle"><span class="marginnote"><img src="tufte-css/img/rhino.png" title=" Rhino image"/>F.J. Cole, “The History of Albrecht Dürer’s Rhinoceros in Zooological Literature,” <em>Science, Medicine, and History: Essays on the Evolution of Scientific Thought and Medical Practice (London, 1953)</em>, ed. E. Ashworth Underwood, 337-356. From page 71 of Edward Tufte’s <em>Visual Explanations</em>.</span></input></p><p>How could xmark support margin figures easily? By abusing the construct, of course.</p><p>xmark abuses the title part of the image (that appears when you place the mouse over the image for a while), and if the title starts with the word 'margin' then the image is placed in a margin note, and if the title starts with the word 'fullwidth' then the image will be rendered as a full-width figure. The conventions are then:</p><blockquote><p>If the title of the image starts with the word <span class="code">margin</span> the figure will be placed in the margin.</p></blockquote><blockquote><p>If the title of the image starts with the word <span class="code">fullwidth</span> the figure will be full-width.</p></blockquote><p>So any image constructed like this:</p><pre class="code"><code class="code">![text caption here](image-name-or-url "margin Rhino image")
</code></pre><p>(note the <span class="code">margin</span> word at the beginning of the title) will be considered a margin figure.</p><p>And the following markup:</p><pre class="code"><code class="code">![Edward Tufte’s English translation of the
Napoleon’s March data visualization.
From *Beautiful Evidence*, page
122-124.](tufte-css/img/napoleons-march.png
"fullwidth Napoleon's march").
</code></pre><p>Will be rendered as:</p><p><figure class="fullwidth"><img src="tufte-css/img/napoleons-march.png" title=" Napoleon's march"/><figcaption>
                                                Fig. 3. Edward Tufte’s English translation of the Napoleon’s March data visualization. From <em>Beautiful Evidence</em>, page 122-124.</figcaption></figure>.</p><p>Note that the <span class="code">margin</span> and <span class="code">fullwidth</span> special words are removed from the resulting HTML figure title. As in Tufte-CSS, full-width images are also numbered automaticcally with xmark.</p><h3 id="idm35151467183152">Source code convention</h3><p>Source code is translated to tufte-css equivalents, but CommonMark's <span class="code">info-string</span> tag is kept, so it is possible to remember which programming language is being used for each part of the code.</p><p>So, for instance, the markdown paragraph:</p><pre class="code"><code class="code">``` ruby
def foo(x)
        return 3
end
```
</code></pre><p>That is tagged as a Ruby program, will be translated to the HTML equivalent:</p><pre class="code"><code class="code">&lt;pre class='code'&gt;&lt;code class='language-ruby code'&gt;def foo(x)
        return 3
end&lt;/code&gt;&lt;/pre&gt;
</code></pre><h2 id="idm35151467078832">Deviations from tufte-css</h2><h3 id="idm35151467077808">Table of Contents</h3><p>xmark automatically generates a Table of Contents and places it in a marginnote at the top of the document.</p><p>You can disable this feature by setting the XSLT parameter <span class="code">generate-toc</span> to <span class="code">no</span> (see below for an example).</p><h3 id="idm35151467072944">Sections</h3><p>xmark does not generate <span class="code">&lt;section&gt;</span> HTML 5 tags.</p><h2 id="idm35151467070000">Using xmark</h2><p>In order to use xmark one needs the following software:</p><ol start="1"><li><p>A CommonMark processor that generates XML, such as the excellent <a href="https://github.com/jgm/cmark" title="">John MacFarlane's cmark</a>.</p></li><li><p>The tufte-css project under the 'tufte-css' folder in a working directory of your liking.</p></li><li><p>The xmark.xsl stylesheet, <a href="https://github.com/vieiro/xmark/blob/master/xmark.xsl" title="">available here</a>.</p></li><li><p>An XSLT processor, such as <a href="http://www.xmlsoft.org" title="">xsltproc</a>. If you're using Mac OS/X, Linux or FreeBSD you may already have it installed.</p></li></ol><p>If you have cloned <a href="https://github.com/vieiro/xmark" title="">xmark's github repository</a> you can issue the <span class="code">git submodule init</span> command to clone CommonMark's cmark and tufte-css projects.</p><p>Once everything is set up you process your CommonMark file (<span class="code">myfile.markdown</span>) with cmark, and then pipe that to xsltproc to generate an output file <span class="code">myfile.html</span>, like so:</p><pre class="code"><code class="code">cmark -t xml myfile.markdown | xsltproc --novalid --nonet xmark.xsl - &gt; myfile.html
</code></pre><p>Or, if you want to disable the Table of Contents:</p><pre class="code"><code class="code">cmark -t xml myfile.markdown | xsltproc --novalid --nonet \
   --stringparam generate.toc no xmark.xsl - &gt; myfile.html
</code></pre><p>And, if you want to disable syntax highlighting:</p><pre class="code"><code class="code">cmark -t xml myfile.markdown | xsltproc --novalid --nonet \
   --stringparam highlight no xmark.xsl - &gt; myfile.html
</code></pre><h3 id="idm35151467113264">License</h3><p>xmark is released under the MIT License.</p><h2 id="idm35151467111344">Further reading</h2><p>Some links you may find of interest:</p><ul><li><p><a href="https://edwardtufte.github.io/tufte-css/" title="">Tufte CSS homepage</a></p></li><li><p><a href="http://commonmark.org" title="">CommonMark homepage</a></p></li><li><p><a href="https://github.com/vieiro/xmark" title="">xmark's project page at github</a>.</p></li><li><p><a href="https://raw.githubusercontent.com/vieiro/xmark/master/test.markdown" title="">The source of this document</a></p></li><li><p><a href="https://github.com/vieiro/xmark/blob/master/test.markdown" title="">This document as rendered by GitHub</a></p></li></ul><h2 id="idm35151467099312">Epilogue</h2><p>Many thanks go to Edward Tufte, Dave Liepmann, John Gruber, John MacFarlane, Ivan Sagalaev and the CommonMark volunteers.</p></article></body></html>